<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Eskom Calendar</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hyphenopoly/4.12.0/Hyphenopoly_Loader.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
<style>
  ul{
 -webkit-column-count: 3;
 -moz-column-count: 3;
 -o-column-count: 3;
  column-count: 3; 
} 
</style>
</head>

<body class="bg-light">
  <a class="github-fork-ribbon" href="https://github.com/beyarkay/eskom-calendar" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
  <div class="container">
    <nav class="navbar navbar-expand-lg bg-primary navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Navbar w/ text</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Pricing</a>
            </li>
          </ul>
          <span class="navbar-text">
            Navbar text with an inline element
          </span>
        </div>
      </div>
    </nav>
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Eskom Calendar</h5><span>by</span>&nbsp<span><a href="https://github.com/beyarkay">Boyd Kane</a></span>
        <p class="card-text">Loadshedding schedules in your digital calendar. No ads, up-to-date, and developer friendly.</p>
        <p class="card-text"><small class="text-muted">Last updated <span id="last-updated"></span></small></p>
        <img src="https://badgen.net/github/license/beyarkay/eskom-calendar?color=orange&cache=600" alt="license" style="max-width: 100%;">
        <img src="https://badgen.net/github/assets-dl/beyarkay/eskom-calendar?color=green" alt="downloads" style="max-width: 100%;">
        <img src="https://badgen.net/github/stars/beyarkay/eskom-calendar?color=yellow" alt="stars" style="max-width: 100%;">
        <img src="https://badgen.net/github/watchers/beyarkay/eskom-calendar?color=cyan" alt="stars" style="max-width: 100%;">
        <img src="https://badgen.net/github/forks/beyarkay/eskom-calendar?color=purple" alt="stars" style="max-width: 100%;">
      </div>
      <!-- <img src="https://github.com/beyarkay/eskom-calendar/releases/download/builds/calendar_preview.png" class="card-img-bottom" alt="..."> -->
    </div>

    <!-- <div class="card mb-3">
      <div class="row g-0">
        <div class="col-md-4">
          <div class="card-body">
            <h5 class="card-title mb-0">Eskom Calendar</h5><span>by</span>&nbsp<span><a href="https://github.com/beyarkay">Boyd Kane</a></span>
            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
          </div>
        </div>
        <div class="col-md-7">
          <img src="https://github.com/beyarkay/eskom-calendar/releases/download/builds/calendar_preview.png" class="img-fluid rounded-start" alt="...">
        </div>
      </div>
    </div> -->
    <div class="text-center" id="spinner">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    <div class="accordion" id="calendar-accordion">
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
  <script>

    var dict = {
      'city-of-cape-town' : {
        'display_name': 'City of Cape Town',
        'province': 'western-cape',
        'areas': []
      },
      'city-power' : {
        'display_name': 'City Power',
        'province': 'gauteng',
        'areas': []
      },
      'eastern-cape': {
        'display_name': 'Eastern Cape',
        'province': 'eastern-cape',
        'areas': []
      },
      'free-state': {
        'display_name': 'Free State',
        'province': 'free-state',
        'areas': []
      },
      'gauteng-ekurhuleni': { 
        'display_name': 'Gauteng (Ekurhuleni)',
        'province': 'gauteng',
        'areas': []
      },
      'gauteng-tshwane': {
        'display_name': 'Gauteng (Tshwane)',
        'province': 'gauteng',
        'areas': []
      },
      'kwazulu-natal': {
        'display_name' : 'KwaZulu-Natal',
        'province': 'kwazulu-natal',
        'areas': []
      },
      'limpopo': {
        'display_name': 'Limpopo',
        'province': 'limpopo',
        'areas': []
      },
      'mpumalanga': {
        'display_name': 'Mpumalanga',
        'province': 'mpumalanga',
        'areas': []
      },
      'north-west': {
        'display_name': 'North West',
        'province': 'north-west',
        'areas': []
      },
      'northern-cape': {
        'display_name': 'Northern Cape',
        'province': 'northern-cape',
        'areas': []
      },
      'western-cape': {
        'display_name': 'Western Cape',
        'province': 'western-cape',
        'areas': []
      }
    }
    $(document).ready(function () {
      var md = markdownit();
      $.ajax({
      type: "GET",
      url: "https://api.github.com/repos/beyarkay/eskom-calendar/releases/latest",//https://github.com/beyarkay/eskom-calendar/releases/tag/latest
      dataType: "json",
      headers: {
      "Accept": "application/json",
      "Content-Type": "application/json",
    },
      success: function (result) {
        var assets = $.map(result.assets, function(e) { return  { name: e.name, url: e.browser_download_url, size: e.size, downloads: e.download_count}});
        console.log("tag name: " + result.tag_name);
        console.log("tag created at: " + result.created_at);
        console.log("tag published at: " + result.published_at);
        var parsed = md.parse(result.body);
        $('#last-updated').html(moment(result.created_at).fromNow());
        $.each(dict, function(key, index) {
          dict[key].areas = assets.filter(function(asset, i) {
            return asset.name.indexOf(key) == 0;
          })
          $('#calendar-accordion').append(
            $('<div>').addClass('accordion-item').append(
              $('<h2>').addClass('accordion-header').attr('id', key + '_heading').append(
                $('<button>').addClass('accordion-button collapsed')
                            .attr('type', 'button')
                            .attr('data-bs-toggle', 'collapse')
                            .attr('data-bs-target', '#' + key + '_collapse')
                            .attr('aria-controls', key + '_collapse')
                            .attr('aria-expanded', 'false')
                            .html(dict[key].display_name))
                ).append(
                  $('<div>').addClass('accordion-collapse collapse')
                    .attr('id', key + '_collapse')
                    .attr('data-bs-parent', '#calendar-accordion')
                    .attr('aria-labelledby', key + '_heading')
                    .append(
                    $('<div>').addClass('accordion-body')
                      .append($('<ul>')
                      .append(
                        $.map(dict[key].areas, function(a, area) {
                          // return $('<li>').append($('<a>').attr('href', a.url).html((a.name.replace(key, '')).replace(/-/g,' ').replace('.ics', '').trim())).append($('<span>').addClass('badge bg-info ms-2').html(a.downloads))
                          return $('<li>').append($('<a>').attr('href', a.url).html((a.name.replace(key, '')).replace(/-/g,' ').trim()))
                        })
                      ))
                  )
                ))
        })
        $('#spinner').hide()
      }
    });
    })
   
  </script>
</body>

</html>